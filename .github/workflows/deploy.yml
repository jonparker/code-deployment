name: Dispatch Event

on:
  pull_request:
    types: [opened]

jobs:
  run_deployment:
    env:
      GH_TOKEN: ${{ github.token }}
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch V2
        run: |
          gh workflow run run-tests.yml -f env=acceptance -f release=1.2 -f deployment_id=3 --repo github.com/jonparker/smoke-test
      - name: Dispatch Event to Other Repo
        uses: actions/github-script@v4
        with:
          script: |
            const { Octokit } = require("@octokit/rest");
            const octokit = new Octokit({
              auth: process.env.GITHUB_TOKEN
            });

            await octokit.request('POST /repos/:owner/:repo/dispatches', {
              owner: 'jonparker',
              repo: 'smoke-test',
              event_type: 'run-smoke-test',
              client_payload: {
                env: 'acceptance',
                release: '1.2',
                deployment_id: '3'
              }
            })
